## **文件 1 全文（LIDC-IDRI 纵向推理分割任务设定）**

以 LIDC-IDRI (Lung Image Consortium / Image Database Resource Initiative) 为例，可以把演变推理分割（Longitudinal Reasoning Segmentation）任务落地为一个清晰、可复现的研究设定。

一、数据特点与可利用信息  
· 模态：低剂量胸部 CT，标准化 DICOM，层厚 1-3 mm  
· 标签：每个结节由多位放射科医生给出边界轮廓及属性（直径、形态、密度等）  
· 多时相性：部分受试者在不同时间点（通常间隔数月至一年）有重复扫描；同一结节可在多个扫描中匹配  
· 元数据：病灶类型（实性、部分实性、磨玻璃）、恶性评分、直径值等  
这些元素天然支持“病灶随访变化研究”：同一结节在 t₁、t₀ 的体积与密度变化、形态演化、信号纹理差异，都可用作推理条件

二、任务定义  
输入  
· 同一患者两次 CT：I_{t₀}, I_{t₁}  
· 对应的结节掩膜或检测框  
· 一条自然语言指令 Q，描述病灶演变逻辑，如：  
 - “分割所有较上次体积增加超过 25% 的结节”  
 - “标出新出现的磨玻璃结节”  
 - “圈出边界由清晰变模糊的病灶”  
输出  
· 满足指令的掩膜 M\*；可附带解释图（变化热图）或实例级表格

三、数据准备流程

1. 病例配对：根据 PatientID 和扫描日期，选择至少两次扫描的病例（约 60-80 例可满足）
    
2. 病灶配准与匹配  
     - 刚性配准（基于肺实质）→ 非刚性配准（B-spline）对齐体积  
     - IoU + 空间距离 + 形态特征综合匹配同一结节，建立 ID 映射
    
3. 变化计算  
     - 体积变化率 ΔV%  
     - 平均 CT 值差（反映密度）  
     - 边界模糊度（基于梯度/纹理指标）
    
4. 生成“推理指令-标签”对  
     - 依据阈值（±20%、±30%）自动生成指令句  
     - 随机扰动阈值或取反生成对照样本（用于评估忠实度）
    

* * *

## **文件 2 全文（子任务、模型设计、评测指标）**

四、任务类型  
子任务 | 指令示例 | 标签生成 | 评价  
T1 体积阈值推理 | “体积增加 ≥25% 的结节” | 利用 V 计算 | 实例级准确率 + Dice  
T2 新发/消退病灶 | “新出现的结节” | 出现在 t₁、缺失于 t₀ | 检测 F1 + 分割 Dice  
T3 密度/形态变化 | “从磨玻璃变实性” | 平均 HU 变化 + 纹理统计 | 条件一致率  
T4 多属性组合 | “体积 ≥20% 且 HU ≥150” | 同上 | 多条件满足率

五、模型设计

1. 图像差分编码  
     - Siamese UNet：两时点共享编码器，输出差异特征 ΔF  
     - 输入形式：  
      · 直接拼接通道 [I_{t₀}, I_{t₁}]，或  
      · 先配准后做差 |I_{t₁} - I_{t₀}|
    
2. 文本条件调制  
     - 文本嵌入（ClinicalBERT 或 Chinese-MedBERT）→ Feature-wise Linear Modulation (FiLM) 或 Cross-Attention 注入解码器  
     - 关键：从指令中解析阈值与属性词（体积、密度、边界等）
    
3. 输出头  
     - 主分割头 M  
     - 辅助 Δ-预测头（体积/密度变化）  
     - 可加条件一致性损失 L_{rule}
    

六、评测指标

- 几何一致性：Dice、HD95
    
- 演变识别：  
     · 实例级 Progression/Stable/Regression 准确率  
     · 新发检测 Precision/F1
    
- 条件一致性：满足指令条件的体素比例
    
- 阈值偏差：预测体积变化